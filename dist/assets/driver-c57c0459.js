import{r as g,j as e,S as se,T as P,P as i,t as Ee,I as Ie,e as I,f as Oe,M as Y,B as V,s as We,w as Re,h as ze,W as Fe}from"./index-2645332a.js";import{g as Me}from"./hotel-30c6b3dd.js";import{g as Ke}from"./agency-a921e9d4.js";import{a as z}from"./axios-9b9683dd.js";import{L as J,A as Q,D as X,d as O,u as Le}from"./utc-8aaacdb4.js";import{E as He,D as le,a as oe,b as ce,G as x,c as de,T as F,d as p,e as $e,f as Ge,g as qe,h as Ue,i as Ye,j as Be,k as Ve}from"./jspdf.plugin.autotable-9666bd39.js";import{T as j}from"./InputAdornment-472adb5f.js";import{A as B}from"./Autocomplete-71648c72.js";import{B as W}from"./Button-c4b246cf.js";import{C as Je}from"./Container-b1a1dd66.js";import{C as Qe}from"./Card-2e36717f.js";import"./useThemeProps-a1c2bdb3.js";import"./Menu-58305863.js";import"./visuallyHidden-fa9934b5.js";import"./typeof-7fd5df1e.js";import"./usePreviousProps-40fa64ff.js";const M="http://127.0.0.1:5005",Xe=async()=>{try{return(await z.get(`${M}/api/driver/`)).data}catch{return 500}},Ze=async t=>{try{return(await z.post(`${M}/api/driver/`,t)).data}catch{return 500}},et=async t=>{try{return(await z.post(`${M}/api/driver/putdriverdata`,t)).data}catch{return 500}},tt=async t=>{try{return(await z.post(`${M}/api/driver/deletedata`,t)).data}catch{return 500}};function ae(t){const n=new Date(t),s={weekday:"long",year:"numeric",month:"long",day:"2-digit"};return n.toLocaleDateString("en-US",s)}const Z=t=>{if(!t)return"";const[n,s]=t.split(" ");let[l,c]=n.split(":");return s==="PM"&&l!=="12"&&(l=String(parseInt(l,10)+12)),s==="AM"&&l==="12"&&(l="00"),l=l.padStart(2,"0"),c=c.padStart(2,"0"),`${l}:${c}`},nt={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function at(t,n,s){return t?Math.max(0,(1+t)*n-s):0}function re(t,n,s){return t[s]===null?1:n[s]===null||n[s]<t[s]?-1:n[s]>t[s]?1:0}function rt(t,n){return t==="desc"?(s,l)=>re(s,l,n):(s,l)=>-re(s,l,n)}function it({inputData:t,comparator:n,filterName:s}){const l=t.map((c,y)=>[c,y]);return l.sort((c,y)=>{const m=n(c[0],y[0]);return m!==0?m:c[1]-y[1]}),t=l.map(c=>c[0]),s&&(t=t.filter(c=>c.name.toLowerCase().indexOf(s.toLowerCase())!==-1)),t}const st=t=>{console.log(t);const n=new He({orientation:"landscape",unit:"mm",format:[210,297]});n.setFontSize(12),n.text("Transfer order for",10,20),n.text(ae(t.service_date),170,20),n.text("CLIENT NAME : ",10,35),n.text("AGENCY:",10,50),n.setFontSize(20),n.text(t.order_for,100,20),n.setFontSize(18),n.text(t.client||"",100,35),n.text(t.agency||"",100,50);const s=[{header:"Client Name",dataKey:"client"},{header:"From",dataKey:"from"},{header:"To",dataKey:"to"},{header:"Pick Up Time",dataKey:"pickup_time"},{header:"Flight No",dataKey:"fligth_no"},{header:"Date Service",dataKey:"service_date"},{header:"Adult",dataKey:"adult"},{header:"Child",dataKey:"child"},{header:"Infant",dataKey:"infant"},{header:"Teen",dataKey:"teen"},{header:"Resa_Remarks",dataKey:"resa_remark"}],l=[{client:t.client,from:t.from,to:t.to,pickup_time:Z(t.pickup_time),flight_no:t.fligth_no,arb_dep:t.arb_dep,service_date:ae(t.service_date),adult:t.adult,child:t.child,infant:t.infant,teen:t.teen,resa_remark:t.resa_remark}],c=[{header:"Vehicle Category",dataKey:"veh_cat"},{header:"Veh Number",dataKey:"veh_no"},{header:"Driver Signature",dataKey:"driver_sign"},{header:"Comments",dataKey:"comments"}],y=[{veh_cat:t.veh_cat,veh_no:t.veh_no,driver_sign:"",comments:t.comments}];n.autoTable({head:[s.map(b=>b.header)],body:l.map(b=>s.map(d=>b[d.dataKey])),startY:70,styles:{fontSize:12}});const m=n.previousAutoTable.finalY,o=15;n.autoTable({head:[c.map(b=>b.header)],body:y.map(b=>c.map(d=>b[d.dataKey])),startY:m+o,styles:{fontSize:12}});const u=n.internal.pageSize.height;n.setFontSize(12),n.text("Signature of the guest",10,u-50),n.text("Date: ",10,u-35),n.save(`driver_planning_${Date.now()} .pdf`)},ie={driver_no:null,order_for:null,agency:null,client:null,from:null,to:null,pickup_time:null,fligth_no:null,arb_dep:null,service_date:null,adult:null,child:null,infant:null,teen:null,resa_remark:null,veh_cat:null,veh_no:null,comments:null,_id:""};function ue({open:t,onClose:n,onSave:s,initialData:l,maxNumber:c,hotel:y,agency:m}){const[o,u]=g.useState(ie);function b(r){const f=new Date(r);let v=f.getHours();const D=String(f.getMinutes()).padStart(2,"0"),C=v>=12?"PM":"AM";return v=v%12||12,`${String(v).padStart(2,"0")}:${D} ${C}`}g.useEffect(()=>{console.log(c),u(l?{...l,pickup_time:Z(l.pickup_time)}:{...ie,driver_no:c+1})},[l,c]);const d=r=>{const{name:f,value:v}=r.target;u({...o,[f]:v})},N=()=>{const r={...o};Object.entries(r).forEach(([f,v])=>{if(v instanceof Date){const D=new Date(v),w=-D.getTimezoneOffset()/60===2?new Date(D.getTime()+108e5).toString():v;r[f]=w}else{const D=Date.parse(`1970-01-01T${v}`);Number.isNaN(D)||(r[f]=b(D))}}),s(r),n()},k=m.map(r=>({label:r.name,value:r.name})),S=y.map(r=>({label:r.name,value:r.name}));return e.jsxs(le,{open:t,onClose:n,maxWidth:"xl",fullWidth:!0,children:[e.jsx(oe,{sx:{bgcolor:"primary.main",color:"white"},children:l?"Edit Driver Data":"New Driver Data"}),e.jsx(ce,{children:e.jsxs(se,{spacing:3,children:[e.jsx(P,{variant:"h6",sx:{mt:2},children:"General Information"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(j,{label:"Data No",name:"driver_no",value:o.driver_no,disabled:!0,onChange:d,fullWidth:!0,variant:"outlined"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(j,{label:"Transfer order for",name:"order_for",value:o.order_for,onChange:d,fullWidth:!0,variant:"outlined"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(j,{label:"Client",name:"client",value:o.client,onChange:d,fullWidth:!0,variant:"outlined"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(B,{options:k,getOptionLabel:r=>r.label,value:k.find(r=>r.value===o.agency)||null,onChange:(r,f)=>{d({target:{name:"agency",value:f?f.value:""}})},fullWidth:!0,renderInput:r=>e.jsx(j,{...r,label:"Agency",variant:"outlined"})})})]}),e.jsx(P,{variant:"h6",sx:{mt:2},children:"Service Details"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(B,{options:S,getOptionLabel:r=>r.label,value:S.find(r=>r.value===o.from)||null,onChange:(r,f)=>{d({target:{name:"from",value:f?f.value:""}})},fullWidth:!0,renderInput:r=>e.jsx(j,{...r,label:"From",variant:"outlined"})})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(B,{options:S,getOptionLabel:r=>r.label,value:S.find(r=>r.value===o.to)||null,onChange:(r,f)=>{d({target:{name:"to",value:f?f.value:""}})},fullWidth:!0,renderInput:r=>e.jsx(j,{...r,label:"To",variant:"outlined"})})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsx(J,{dateAdapter:Q,children:e.jsx(X,{label:"Service Date",name:"service_date",value:O(o.service_date),onChange:r=>u({...o,service_date:r?O(r).toDate():null}),fullWidth:!0,renderInput:r=>e.jsx(j,{...r})})})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsx(j,{label:"Arrival/Departure",name:"arb_dep",value:o.arb_dep,onChange:d,fullWidth:!0,variant:"outlined"})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsx(j,{label:"Pickup Time",name:"pickup_time",value:o.pickup_time,onChange:d,fullWidth:!0,variant:"outlined",type:"time",InputLabelProps:{shrink:!0}})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsx(j,{label:"Flight No",name:"fligth_no",value:o.fligth_no,onChange:d,fullWidth:!0,variant:"outlined"})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsx(j,{label:"Adult",name:"adult",value:o.adult,onChange:d,fullWidth:!0,variant:"outlined",type:"number"})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsx(j,{label:"Child",name:"child",value:o.child,onChange:d,fullWidth:!0,variant:"outlined",type:"number"})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsx(j,{label:"Infant",name:"infant",value:o.infant,onChange:d,fullWidth:!0,variant:"outlined"})}),e.jsx(x,{item:!0,xs:12,sm:3,children:e.jsx(j,{label:"Teen",name:"teen",value:o.teen,onChange:d,fullWidth:!0,variant:"outlined"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(j,{label:"Resa_remarks",name:"resa_remark",value:o.resa_remark,onChange:d,fullWidth:!0,variant:"outlined"})})]}),e.jsx(P,{variant:"h6",sx:{mt:2},children:"Driver Information"}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(j,{label:"Vehicle Category",name:"veh_cat",value:o.veh_cat,onChange:d,fullWidth:!0,variant:"outlined"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(j,{label:"Vehicle No",name:"veh_no",value:o.veh_no,onChange:d,fullWidth:!0,variant:"outlined"})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(j,{label:"Comments",name:"comments",value:o.comments,onChange:d,fullWidth:!0,variant:"outlined"})})]})]})}),e.jsxs(de,{children:[e.jsx(W,{onClick:n,color:"inherit",children:"Cancel"}),e.jsx(W,{onClick:N,variant:"contained",children:"Save"})]})]})}ue.propTypes={open:i.bool,onClose:i.func,onSave:i.func,initialData:i.object,maxNumber:i.any,hotel:i.any,agency:i.any};function he({query:t}){return e.jsx(F,{children:e.jsx(p,{align:"center",colSpan:6,sx:{py:3},children:e.jsxs(Ee,{sx:{textAlign:"center"},children:[e.jsx(P,{variant:"h6",paragraph:!0,children:"Not found"}),e.jsxs(P,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}he.propTypes={query:i.string};function lt(t){const n=new Date(t),s=String(n.getDate()).padStart(2,"0"),l=String(n.getMonth()+1).padStart(2,"0");return`${n.getFullYear()}-${l}-${s}`}function me({id:t,driver_no:n,order_for:s,agency:l,client:c,from:y,to:m,pickup_time:o,fligth_no:u,arb_dep:b,service_date:d,adult:N,child:k,infant:S,teen:r,resa_remark:f,veh_cat:v,veh_no:D,comments:C,editAction:w,deleteAction:K,exportAction:E}){const[R,T]=g.useState(null),L=q=>{T(q.currentTarget)},A=()=>{T(null)},H=()=>{w(),T(null)},$=()=>{K(),T(null)},G=()=>{E(t),T(null)};return e.jsxs(e.Fragment,{children:[e.jsxs(F,{hover:!0,tabIndex:-1,role:"checkbox",children:[e.jsx(p,{children:n}),e.jsx(p,{children:s}),e.jsx(p,{children:l}),e.jsx(p,{children:c}),e.jsx(p,{children:y}),e.jsx(p,{children:m}),e.jsx(p,{children:Z(o)}),e.jsx(p,{children:u}),e.jsx(p,{children:b}),e.jsx(p,{children:lt(d)}),e.jsx(p,{children:N}),e.jsx(p,{children:k}),e.jsx(p,{children:S}),e.jsx(p,{children:r}),e.jsx(p,{children:f}),e.jsx(p,{children:v}),e.jsx(p,{children:D}),e.jsx(p,{children:C}),e.jsx(p,{align:"right",children:e.jsx(Ie,{onClick:L,children:e.jsx(I,{icon:"eva:more-vertical-fill"})})})]}),e.jsxs(Oe,{open:!!R,anchorEl:R,onClose:A,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{width:140}},children:[e.jsxs(Y,{onClick:G,sx:{color:"success.main"},children:[e.jsx(I,{icon:"eva:download-outline",sx:{mr:2}}),"Export"]}),e.jsxs(Y,{onClick:H,children:[e.jsx(I,{icon:"eva:edit-fill",sx:{mr:2}}),"Edit"]}),e.jsxs(Y,{onClick:$,sx:{color:"error.main"},children:[e.jsx(I,{icon:"eva:trash-2-outline",sx:{mr:2}}),"Delete"]})]})]})}me.propTypes={id:i.any,driver_no:i.any,order_for:i.any,agency:i.any,client:i.any,from:i.any,to:i.any,pickup_time:i.any,fligth_no:i.any,arb_dep:i.any,service_date:i.any,adult:i.any,child:i.any,infant:i.any,teen:i.any,resa_remark:i.any,veh_cat:i.any,veh_no:i.any,comments:i.any,editAction:i.func,deleteAction:i.func,exportAction:i.func};const ot=We(Ge)(({theme:t})=>({position:"sticky",top:0,backgroundColor:"#ddf4ff",zIndex:t.zIndex.appBar}));function pe({order:t,orderBy:n,rowCount:s,headLabel:l,numSelected:c,onRequestSort:y,onSelectAllClick:m}){const o=u=>b=>{y(b,u)};return e.jsx(ot,{children:e.jsx(F,{children:l.map(u=>e.jsx(p,{align:u.align||"left",sortDirection:n===u.id?t:!1,sx:{width:u.width,minWidth:u.minWidth,backgroundColor:"#aaf4ff",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",padding:"4px",paddingTop:"10px",paddingBottom:"10px"},children:e.jsxs($e,{hideSortIcon:!0,active:n===u.id,direction:n===u.id?t:"asc",onClick:o(u.id),children:[u.label,n===u.id?e.jsx(V,{sx:{...nt},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},u.id))})})}pe.propTypes={order:i.oneOf(["asc","desc"]),orderBy:i.string,rowCount:i.number,headLabel:i.array,numSelected:i.number,onRequestSort:i.func,onSelectAllClick:i.func};function fe({emptyRows:t,height:n}){return t?e.jsx(F,{sx:{...n&&{height:n*t}},children:e.jsx(p,{colSpan:9})}):null}fe.propTypes={emptyRows:i.number,height:i.number};O.extend(Le);function xe({onGetDate:t,onGetEndDate:n,NewAction:s,loading:l}){const c=m=>{const o=O(m).toDate();t(o)},y=m=>{const o=O(m).toDate();n(o)};return e.jsxs(Re,{sx:{height:96,display:"flex",justifyContent:"space-between",p:m=>m.spacing(0,1,0,3),color:"primary.main",bgcolor:"#aaf4ff"},children:[e.jsxs(V,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(J,{dateAdapter:Q,children:e.jsx(X,{label:"Select Start Date",onChange:c,renderInput:m=>e.jsx(j,{...m})})}),e.jsx(J,{dateAdapter:Q,children:e.jsx(X,{label:"Select End Date",onChange:y,renderInput:m=>e.jsx(j,{...m,sx:{ml:4}})})})]}),e.jsx(V,{sx:{ml:"auto"},children:e.jsx(W,{variant:"contained",onClick:s,color:"inherit",startIcon:e.jsx(I,{icon:"eva:plus-fill"}),disabled:l,children:l?"Loading Data...":"New Driver Plan Data"})})]})}xe.propTypes={onGetDate:i.func.isRequired,onGetEndDate:i.func.isRequired,NewAction:i.func.isRequired,loading:i.bool};function ct(){const[t,n]=g.useState([]),[s,l]=g.useState(0),[c,y]=g.useState("desc"),[m,o]=g.useState("_id"),[u,b]=g.useState(""),[d,N]=g.useState(15),[k,S]=g.useState(!1),[r,f]=g.useState(null),[v,D]=g.useState(null),[C,w]=g.useState(null),[K,E]=g.useState(!1),[R,T]=g.useState(""),[L,A]=g.useState(""),[H,$]=g.useState([]),[G,q]=g.useState([]),[ge,ee]=g.useState(!1),ve=(a,h)=>{h!==""&&(y(m===h&&c==="asc"?"desc":"asc"),o(h))};g.useEffect(()=>{(async()=>{try{ee(!0);const h=await Me(),_=await Ke();$(h.data),q(_.data)}catch{alert("network Error. Refresh page")}finally{ee(!1)}})()},[]);const je=(a,h)=>{l(h)},ye=a=>{l(0),N(parseInt(a.target.value,10))},be=a=>{l(0),b(a.target.value)},te=it({inputData:t,comparator:rt(c,m),filterName:u}),_e=async a=>{const h=new Date(a),U=-h.getTimezoneOffset()/60===2?new Date(h.getTime()+108e5).toString():a;D(U)},De=async a=>{const h=new Date(a),U=-h.getTimezoneOffset()/60===2?new Date(h.getTime()+108e5).toString():a;w(U)};g.useEffect(()=>{(async()=>{if(!v||!C){const h=await Xe();h===500?alert("Network Error"):(n(h.data),A(h.max_num))}else{if(v>C){alert("Input currece Date!");return}l(0);try{const _=await Ze({start:v,end:C});_===500?alert("Network Error"):(n(_.data),A(_.max_num))}catch(h){console.error("Error fetching data:",h),alert("An unexpected error occurred")}}})()},[v,C]);const Ce=()=>{f(null),S(!0)},Se=a=>{f(a),S(!0)},Te=()=>{S(!1)},ke=async a=>{const _=await et({start:v,end:C,newData:a});_===500?alert("Network Error"):(alert(r?"A data updated successfully":"A data added successfully"),n(_.data),A(_.max_num))},Ae=a=>{T(a._id),E(!0)},Pe=async()=>{E(!1);const h=await tt({start:v,end:C,id:R});h===500?alert("Network Error."):(alert("A data deleted successfully."),n(h.data),A(h.max_num))},ne=()=>{E(!1)},Ne=a=>{st(a)},we=!te.length&&!!u;return e.jsxs(Je,{maxWidth:!1,children:[e.jsx(se,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:e.jsx(P,{variant:"h4",children:"Driver Planning"})}),e.jsxs(Qe,{children:[e.jsx(xe,{filterName:u,onFilterName:be,onGetDate:_e,onGetEndDate:De,NewAction:Ce,loading:ge}),e.jsx(ze,{children:e.jsx(qe,{sx:{overflow:"auto",height:"76vh"},children:e.jsxs(Ue,{sx:{minWidth:800},children:[e.jsx(pe,{order:c,orderBy:m,onRequestSort:ve,headLabel:[{id:"driver_no",label:"No"},{id:"order_for",label:"Trnsfer order for"},{id:"agency",label:"Agency"},{id:"client",label:"Client Name"},{id:"from",label:"From"},{id:"to",label:"To"},{id:"pickup_time",label:"Pick Up Time"},{id:"fligth_no",label:"Flight No"},{id:"arb_dep",label:"Arv / Dep"},{id:"service_date",label:"Service Date"},{id:"adult",label:"Adult"},{id:"child",label:"Child"},{id:"infant",label:"Infant"},{id:"teen",label:"Teen"},{id:"resa_remark",label:"Resa_remarks"},{id:"veh_cat",label:"Vehicle Category"},{id:"veh_no",label:"Vehicle Number"},{id:"comments",label:"Comments"},{id:"",label:""}]}),e.jsxs(Ye,{children:[te.slice(s*d,s*d+d).map(a=>e.jsx(me,{id:a._id,driver_no:a.driver_no,order_for:a.order_for,agency:a.agency,client:a.client,from:a.from,to:a.to,pickup_time:a.pickup_time,fligth_no:a.fligth_no,arb_dep:a.arb_dep,service_date:a.service_date,adult:a.adult,child:a.child,infant:a.infant,teen:a.teen,resa_remark:a.resa_remark,veh_cat:a.veh_cat,veh_no:a.veh_no,comments:a.comments,deleteAction:()=>Ae(a),editAction:()=>Se(a),exportAction:()=>Ne(a)},a._id)),e.jsx(fe,{height:77,emptyRows:at(s,d,t.length)}),we&&e.jsx(he,{query:u})]})]})})}),e.jsx(Be,{page:s,component:"div",count:t.length,rowsPerPage:d,onPageChange:je,rowsPerPageOptions:[5,10,15,25,50,100],onRowsPerPageChange:ye})]}),e.jsx(ue,{open:k,onClose:Te,onSave:ke,initialData:r,maxNumber:L,hotel:H,agency:G}),e.jsxs(le,{open:K,onClose:ne,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(oe,{id:"alert-dialog-title",children:"Confirm Deletion"}),e.jsx(ce,{children:e.jsx(Ve,{id:"alert-dialog-description",children:"Are you sure you want to delete this item? This action cannot be undone."})}),e.jsxs(de,{children:[e.jsx(W,{onClick:ne,color:"primary",children:"Cancel"}),e.jsx(W,{onClick:Pe,color:"error",autoFocus:!0,children:"Delete"})]})]})]})}function Tt(){return e.jsxs(e.Fragment,{children:[e.jsx(Fe,{children:e.jsx("title",{children:" Driver Planning "})}),e.jsx(ct,{})]})}export{Tt as default};
